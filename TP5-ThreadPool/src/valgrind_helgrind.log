==85484== Helgrind, a thread error detector
==85484== Copyright (C) 2007-2017, and GNU GPL'd, by OpenWorks LLP et al.
==85484== Using Valgrind-3.22.0 and LibVEX; rerun with -h for copyright info
==85484== Command: ./threadpool --all
==85484== 
[36m[B01][0m Basic execution (3 tasks on 2 threads)... ==85485== 
==85485== Use --history-level=approx or =none to gain increased speed, at
==85485== the cost of reduced accuracy of conflicting-access information
==85485== For lists of detected and suppressed errors, rerun with: -s
==85485== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 274 from 16)
[1;32m✅ PASSED[0m
[36m[B02][0m Wait without scheduling... ==85489== 
==85489== Use --history-level=approx or =none to gain increased speed, at
==85489== the cost of reduced accuracy of conflicting-access information
==85489== For lists of detected and suppressed errors, rerun with: -s
==85489== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 158 from 12)
[1;32m✅ PASSED[0m
[36m[B03][0m Serial execution with 1 thread... ==85495== 
==85495== Use --history-level=approx or =none to gain increased speed, at
==85495== the cost of reduced accuracy of conflicting-access information
==85495== For lists of detected and suppressed errors, rerun with: -s
==85495== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 338 from 16)
[1;32m✅ PASSED[0m
[36m[B04][0m FIFO execution in single-thread mode... ==85498== 
==85498== Use --history-level=approx or =none to gain increased speed, at
==85498== the cost of reduced accuracy of conflicting-access information
==85498== For lists of detected and suppressed errors, rerun with: -s
==85498== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 613 from 16)
[1;32m✅ PASSED[0m
[36m[B05][0m Concurrent execution integrity (1000 tasks)... ==85512== ---Thread-Announcement------------------------------------------
==85512== 
==85512== Thread #6 was created
==85512==    at 0x4C3EA23: clone (clone.S:76)
==85512==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85512==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85512==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85512==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85512==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85512==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85512==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==85512==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==85512==    by 0x1147E8: test_concurrent_execution_integrity() (test_custom.cc:134)
==85512==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85512==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85512==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85512== 
==85512== ---Thread-Announcement------------------------------------------
==85512== 
==85512== Thread #2 was created
==85512==    at 0x4C3EA23: clone (clone.S:76)
==85512==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85512==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85512==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85512==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85512==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85512==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85512==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==85512==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==85512==    by 0x1147E8: test_concurrent_execution_integrity() (test_custom.cc:134)
==85512==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85512==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85512==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85512== 
==85512== ---Thread-Announcement------------------------------------------
==85512== 
==85512== Thread #1 is the program's root thread
==85512== 
==85512== ----------------------------------------------------------------
==85512== 
==85512==  Lock at 0x1FFEFFE6A0 was first observed
==85512==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85512==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==85512==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==85512==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==85512==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==85512==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85512==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85512==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85512==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85512==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85512==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85512==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85512==  Address 0x1ffeffe6a0 is on thread #1's stack
==85512==  in frame #5, created by test_concurrent_execution_integrity() (test_custom.cc:129)
==85512== 
==85512== Possible data race during read of size 1 at 0x4E27868 by thread #6
==85512== Locks held: none
==85512==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==85512==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85512==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85512==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85512==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85512==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85512==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85512==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85512==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==85512==    by 0x4C3EA33: clone (clone.S:100)
==85512== 
==85512== This conflicts with a previous write of size 1 by thread #2
==85512== Locks held: 1, at address 0x1FFEFFE6A0
==85512==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==85512==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==85512==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==85512==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==85512==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==85512==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==85512==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85512==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85512==  Address 0x4e27868 is 152 bytes inside a block of size 640 alloc'd
==85512==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85512==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==85512==    by 0x1110A6: allocate (alloc_traits.h:482)
==85512==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==85512==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==85512==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==85512==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==85512==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==85512==    by 0x1147E8: test_concurrent_execution_integrity() (test_custom.cc:134)
==85512==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85512==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85512==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85512==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==85512==  Block was alloc'd by thread #1
==85512== 
==85512== 
==85512== Use --history-level=approx or =none to gain increased speed, at
==85512== the cost of reduced accuracy of conflicting-access information
==85512== For lists of detected and suppressed errors, rerun with: -s
==85512== ERROR SUMMARY: 76 errors from 1 contexts (suppressed: 67364 from 16)
[1;31m❌ FAILED[0m
[36m[B06][0m Task execution preserves capture context... ==85526== 
==85526== Use --history-level=approx or =none to gain increased speed, at
==85526== the cost of reduced accuracy of conflicting-access information
==85526== For lists of detected and suppressed errors, rerun with: -s
==85526== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 202 from 16)
[1;32m✅ PASSED[0m
[32m[C01][0m Stress with 1000 tasks... ==85533== ---Thread-Announcement------------------------------------------
==85533== 
==85533== Thread #10 was created
==85533==    at 0x4C3EA23: clone (clone.S:76)
==85533==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85533==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85533==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85533==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85533==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85533==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85533==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==85533==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==85533==    by 0x114C27: test_concurrent_stress() (test_custom.cc:177)
==85533==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85533==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85533==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85533== 
==85533== ---Thread-Announcement------------------------------------------
==85533== 
==85533== Thread #2 was created
==85533==    at 0x4C3EA23: clone (clone.S:76)
==85533==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85533==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85533==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85533==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85533==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85533==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85533==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==85533==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==85533==    by 0x114C27: test_concurrent_stress() (test_custom.cc:177)
==85533==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85533==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85533==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85533== 
==85533== ---Thread-Announcement------------------------------------------
==85533== 
==85533== Thread #1 is the program's root thread
==85533== 
==85533== ----------------------------------------------------------------
==85533== 
==85533==  Lock at 0x1FFEFFE6A0 was first observed
==85533==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85533==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==85533==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==85533==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==85533==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==85533==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85533==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85533==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85533==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85533==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85533==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85533==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85533==  Address 0x1ffeffe6a0 is on thread #1's stack
==85533==  in frame #5, created by test_concurrent_stress() (test_custom.cc:173)
==85533== 
==85533== Possible data race during read of size 1 at 0x4E27868 by thread #10
==85533== Locks held: none
==85533==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==85533==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85533==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85533==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85533==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85533==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85533==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85533==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85533==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==85533==    by 0x4C3EA33: clone (clone.S:100)
==85533== 
==85533== This conflicts with a previous write of size 1 by thread #2
==85533== Locks held: 1, at address 0x1FFEFFE6A0
==85533==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==85533==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==85533==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==85533==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==85533==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==85533==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==85533==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85533==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85533==  Address 0x4e27868 is 152 bytes inside a block of size 1,280 alloc'd
==85533==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85533==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==85533==    by 0x1110A6: allocate (alloc_traits.h:482)
==85533==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==85533==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==85533==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==85533==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==85533==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==85533==    by 0x114C27: test_concurrent_stress() (test_custom.cc:177)
==85533==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85533==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85533==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85533==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==85533==  Block was alloc'd by thread #1
==85533== 
==85533== 
==85533== Use --history-level=approx or =none to gain increased speed, at
==85533== the cost of reduced accuracy of conflicting-access information
==85533== For lists of detected and suppressed errors, rerun with: -s
==85533== ERROR SUMMARY: 3 errors from 1 contexts (suppressed: 64265 from 16)
[1;31m❌ FAILED[0m
[32m[C02][0m Reusing the pool after wait... ==85543== 
==85543== Use --history-level=approx or =none to gain increased speed, at
==85543== the cost of reduced accuracy of conflicting-access information
==85543== For lists of detected and suppressed errors, rerun with: -s
==85543== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 306 from 17)
[1;32m✅ PASSED[0m
[32m[C03][0m Multiple wait() calls... ==85549== 
==85549== Use --history-level=approx or =none to gain increased speed, at
==85549== the cost of reduced accuracy of conflicting-access information
==85549== For lists of detected and suppressed errors, rerun with: -s
==85549== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 225 from 16)
[1;32m✅ PASSED[0m
[32m[C04][0m Alternating heavy/light tasks stress... ==85555== ---Thread-Announcement------------------------------------------
==85555== 
==85555== Thread #6 was created
==85555==    at 0x4C3EA23: clone (clone.S:76)
==85555==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85555==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85555==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85555==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85555==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85555==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85555==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==85555==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==85555==    by 0x11925A: test_alternating_task_weight() (test_custom.cc:905)
==85555==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85555==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85555==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85555== 
==85555== ---Thread-Announcement------------------------------------------
==85555== 
==85555== Thread #3 was created
==85555==    at 0x4C3EA23: clone (clone.S:76)
==85555==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85555==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85555==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85555==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85555==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85555==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85555==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==85555==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==85555==    by 0x11925A: test_alternating_task_weight() (test_custom.cc:905)
==85555==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85555==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85555==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85555== 
==85555== ---Thread-Announcement------------------------------------------
==85555== 
==85555== Thread #1 is the program's root thread
==85555== 
==85555== ----------------------------------------------------------------
==85555== 
==85555==  Lock at 0x1FFEFFE6A0 was first observed
==85555==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85555==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==85555==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==85555==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==85555==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==85555==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85555==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85555==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85555==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85555==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85555==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85555==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85555==  Address 0x1ffeffe6a0 is on thread #1's stack
==85555==  in frame #5, created by test_alternating_task_weight() (test_custom.cc:903)
==85555== 
==85555== Possible data race during read of size 1 at 0x4E27908 by thread #6
==85555== Locks held: none
==85555==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==85555==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85555==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85555==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85555==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85555==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85555==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85555==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85555==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==85555==    by 0x4C3EA33: clone (clone.S:100)
==85555== 
==85555== This conflicts with a previous write of size 1 by thread #3
==85555== Locks held: 1, at address 0x1FFEFFE6A0
==85555==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==85555==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==85555==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==85555==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==85555==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==85555==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==85555==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85555==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85555==  Address 0x4e27908 is 312 bytes inside a block of size 640 alloc'd
==85555==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85555==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==85555==    by 0x1110A6: allocate (alloc_traits.h:482)
==85555==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==85555==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==85555==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==85555==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==85555==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==85555==    by 0x11925A: test_alternating_task_weight() (test_custom.cc:905)
==85555==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85555==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85555==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85555==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==85555==  Block was alloc'd by thread #1
==85555== 
==85555== 
==85555== Use --history-level=approx or =none to gain increased speed, at
==85555== the cost of reduced accuracy of conflicting-access information
==85555== For lists of detected and suppressed errors, rerun with: -s
==85555== ERROR SUMMARY: 68 errors from 1 contexts (suppressed: 76091 from 16)
[1;31m❌ FAILED[0m
[32m[C05][0m Excessive signal calls to dispatcher... ==85573== ---Thread-Announcement------------------------------------------
==85573== 
==85573== Thread #4 was created
==85573==    at 0x4C3EA23: clone (clone.S:76)
==85573==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85573==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85573==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85573==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85573==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85573==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85573==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==85573==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==85573==    by 0x11947C: test_signal_overload() (test_custom.cc:929)
==85573==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85573==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85573==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85573== 
==85573== ---Thread-Announcement------------------------------------------
==85573== 
==85573== Thread #2 was created
==85573==    at 0x4C3EA23: clone (clone.S:76)
==85573==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85573==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85573==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85573==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85573==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85573==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85573==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==85573==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==85573==    by 0x11947C: test_signal_overload() (test_custom.cc:929)
==85573==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85573==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85573==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85573== 
==85573== ---Thread-Announcement------------------------------------------
==85573== 
==85573== Thread #1 is the program's root thread
==85573== 
==85573== ----------------------------------------------------------------
==85573== 
==85573==  Lock at 0x1FFEFFE6A0 was first observed
==85573==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85573==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==85573==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==85573==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==85573==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==85573==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85573==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85573==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85573==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85573==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85573==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85573==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85573==  Address 0x1ffeffe6a0 is on thread #1's stack
==85573==  in frame #5, created by test_signal_overload() (test_custom.cc:924)
==85573== 
==85573== Possible data race during read of size 1 at 0x4E27868 by thread #4
==85573== Locks held: none
==85573==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==85573==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85573==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85573==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85573==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85573==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85573==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85573==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85573==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==85573==    by 0x4C3EA33: clone (clone.S:100)
==85573== 
==85573== This conflicts with a previous write of size 1 by thread #2
==85573== Locks held: 1, at address 0x1FFEFFE6A0
==85573==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==85573==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==85573==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==85573==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==85573==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==85573==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==85573==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85573==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85573==  Address 0x4e27868 is 152 bytes inside a block of size 320 alloc'd
==85573==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85573==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==85573==    by 0x1110A6: allocate (alloc_traits.h:482)
==85573==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==85573==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==85573==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==85573==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==85573==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==85573==    by 0x11947C: test_signal_overload() (test_custom.cc:929)
==85573==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85573==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85573==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85573==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==85573==  Block was alloc'd by thread #1
==85573== 
==85573== 
==85573== Use --history-level=approx or =none to gain increased speed, at
==85573== the cost of reduced accuracy of conflicting-access information
==85573== For lists of detected and suppressed errors, rerun with: -s
==85573== ERROR SUMMARY: 79 errors from 1 contexts (suppressed: 69658 from 16)
[1;31m❌ FAILED[0m
[35m[E01][0m Massive stress (10k tasks)... ==85585== ---Thread-Announcement------------------------------------------
==85585== 
==85585== Thread #18 was created
==85585==    at 0x4C3EA23: clone (clone.S:76)
==85585==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85585==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85585==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85585==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85585==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85585==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85585==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==85585==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==85585==    by 0x115199: test_massive_stress() (test_custom.cc:235)
==85585==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85585==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85585==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85585== 
==85585== ---Thread-Announcement------------------------------------------
==85585== 
==85585== Thread #2 was created
==85585==    at 0x4C3EA23: clone (clone.S:76)
==85585==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85585==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85585==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85585==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85585==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85585==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85585==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==85585==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==85585==    by 0x115199: test_massive_stress() (test_custom.cc:235)
==85585==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85585==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85585==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85585== 
==85585== ---Thread-Announcement------------------------------------------
==85585== 
==85585== Thread #1 is the program's root thread
==85585== 
==85585== ----------------------------------------------------------------
==85585== 
==85585==  Lock at 0x1FFEFFE6A0 was first observed
==85585==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85585==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==85585==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==85585==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==85585==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==85585==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85585==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85585==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85585==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85585==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85585==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85585==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85585==  Address 0x1ffeffe6a0 is on thread #1's stack
==85585==  in frame #5, created by test_massive_stress() (test_custom.cc:231)
==85585== 
==85585== Possible data race during read of size 1 at 0x4E29FD8 by thread #18
==85585== Locks held: none
==85585==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==85585==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85585==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85585==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85585==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85585==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85585==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85585==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85585==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==85585==    by 0x4C3EA33: clone (clone.S:100)
==85585== 
==85585== This conflicts with a previous write of size 1 by thread #2
==85585== Locks held: 1, at address 0x1FFEFFE6A0
==85585==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==85585==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==85585==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==85585==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==85585==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==85585==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==85585==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85585==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85585==  Address 0x4e29fd8 is 152 bytes inside a block of size 2,560 alloc'd
==85585==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85585==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==85585==    by 0x1110A6: allocate (alloc_traits.h:482)
==85585==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==85585==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==85585==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==85585==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==85585==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==85585==    by 0x115199: test_massive_stress() (test_custom.cc:235)
==85585==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85585==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85585==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85585==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==85585==  Block was alloc'd by thread #1
==85585== 
==85585== 
==85585== Use --history-level=approx or =none to gain increased speed, at
==85585== the cost of reduced accuracy of conflicting-access information
==85585== For lists of detected and suppressed errors, rerun with: -s
==85585== ERROR SUMMARY: 125 errors from 1 contexts (suppressed: 629321 from 16)
[1;31m❌ FAILED[0m
[35m[E02][0m Long tasks then shutdown... ==85609== ---Thread-Announcement------------------------------------------
==85609== 
==85609== Thread #6 was created
==85609==    at 0x4C3EA23: clone (clone.S:76)
==85609==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85609==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85609==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85609==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85609==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85609==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85609==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==85609==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==85609==    by 0x1152F1: test_long_tasks_then_quit() (test_custom.cc:250)
==85609==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85609==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85609==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85609== 
==85609== ---Thread-Announcement------------------------------------------
==85609== 
==85609== Thread #2 was created
==85609==    at 0x4C3EA23: clone (clone.S:76)
==85609==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85609==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85609==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85609==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85609==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85609==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85609==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==85609==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==85609==    by 0x1152F1: test_long_tasks_then_quit() (test_custom.cc:250)
==85609==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85609==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85609==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85609== 
==85609== ---Thread-Announcement------------------------------------------
==85609== 
==85609== Thread #1 is the program's root thread
==85609== 
==85609== ----------------------------------------------------------------
==85609== 
==85609==  Lock at 0x1FFEFFE6A0 was first observed
==85609==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85609==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==85609==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==85609==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==85609==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==85609==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85609==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85609==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85609==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85609==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85609==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85609==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85609==  Address 0x1ffeffe6a0 is on thread #1's stack
==85609==  in frame #5, created by test_long_tasks_then_quit() (test_custom.cc:248)
==85609== 
==85609== Possible data race during read of size 1 at 0x4E27868 by thread #6
==85609== Locks held: none
==85609==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==85609==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85609==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85609==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85609==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85609==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85609==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85609==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85609==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==85609==    by 0x4C3EA33: clone (clone.S:100)
==85609== 
==85609== This conflicts with a previous write of size 1 by thread #2
==85609== Locks held: 1, at address 0x1FFEFFE6A0
==85609==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==85609==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==85609==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==85609==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==85609==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==85609==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==85609==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85609==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85609==  Address 0x4e27868 is 152 bytes inside a block of size 640 alloc'd
==85609==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85609==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==85609==    by 0x1110A6: allocate (alloc_traits.h:482)
==85609==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==85609==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==85609==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==85609==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==85609==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==85609==    by 0x1152F1: test_long_tasks_then_quit() (test_custom.cc:250)
==85609==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85609==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85609==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85609==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==85609==  Block was alloc'd by thread #1
==85609== 
==85609== 
==85609== Use --history-level=approx or =none to gain increased speed, at
==85609== the cost of reduced accuracy of conflicting-access information
==85609== For lists of detected and suppressed errors, rerun with: -s
==85609== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 930 from 16)
[1;31m❌ FAILED[0m
[35m[E03][0m Lots of short tasks on few threads... ==85615== ---Thread-Announcement------------------------------------------
==85615== 
==85615== Thread #4 was created
==85615==    at 0x4C3EA23: clone (clone.S:76)
==85615==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85615==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85615==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85615==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85615==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85615==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85615==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==85615==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==85615==    by 0x11543B: test_many_short_tasks_on_few_threads() (test_custom.cc:265)
==85615==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85615==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85615==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85615== 
==85615== ---Thread-Announcement------------------------------------------
==85615== 
==85615== Thread #2 was created
==85615==    at 0x4C3EA23: clone (clone.S:76)
==85615==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85615==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85615==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85615==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85615==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85615==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85615==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==85615==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==85615==    by 0x11543B: test_many_short_tasks_on_few_threads() (test_custom.cc:265)
==85615==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85615==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85615==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85615== 
==85615== ---Thread-Announcement------------------------------------------
==85615== 
==85615== Thread #1 is the program's root thread
==85615== 
==85615== ----------------------------------------------------------------
==85615== 
==85615==  Lock at 0x1FFEFFE6A0 was first observed
==85615==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85615==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==85615==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==85615==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==85615==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==85615==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85615==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85615==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85615==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85615==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85615==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85615==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85615==  Address 0x1ffeffe6a0 is on thread #1's stack
==85615==  in frame #5, created by test_many_short_tasks_on_few_threads() (test_custom.cc:263)
==85615== 
==85615== Possible data race during read of size 1 at 0x4E27868 by thread #4
==85615== Locks held: none
==85615==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==85615==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85615==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85615==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85615==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85615==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85615==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85615==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85615==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==85615==    by 0x4C3EA33: clone (clone.S:100)
==85615== 
==85615== This conflicts with a previous write of size 1 by thread #2
==85615== Locks held: 1, at address 0x1FFEFFE6A0
==85615==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==85615==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==85615==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==85615==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==85615==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==85615==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==85615==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85615==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85615==  Address 0x4e27868 is 152 bytes inside a block of size 320 alloc'd
==85615==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85615==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==85615==    by 0x1110A6: allocate (alloc_traits.h:482)
==85615==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==85615==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==85615==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==85615==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==85615==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==85615==    by 0x11543B: test_many_short_tasks_on_few_threads() (test_custom.cc:265)
==85615==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85615==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85615==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85615==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==85615==  Block was alloc'd by thread #1
==85615== 
==85615== 
==85615== Use --history-level=approx or =none to gain increased speed, at
==85615== the cost of reduced accuracy of conflicting-access information
==85615== For lists of detected and suppressed errors, rerun with: -s
==85615== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 15001 from 16)
[1;31m❌ FAILED[0m
[35m[E04][0m Detect potential deadlock... ==85619== 
==85619== Use --history-level=approx or =none to gain increased speed, at
==85619== the cost of reduced accuracy of conflicting-access information
==85619== For lists of detected and suppressed errors, rerun with: -s
==85619== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 170 from 25)
[1;32m✅ PASSED[0m
[35m[E05][0m Simulated pendingTasks tracking... ==85624== ---Thread-Announcement------------------------------------------
==85624== 
==85624== Thread #6 was created
==85624==    at 0x4C3EA23: clone (clone.S:76)
==85624==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85624==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85624==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85624==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85624==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85624==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85624==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==85624==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==85624==    by 0x115B3B: test_pending_tasks_tracking_simulado() (test_custom.cc:342)
==85624==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85624==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85624==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85624== 
==85624== ---Thread-Announcement------------------------------------------
==85624== 
==85624== Thread #2 was created
==85624==    at 0x4C3EA23: clone (clone.S:76)
==85624==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85624==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85624==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85624==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85624==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85624==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85624==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==85624==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==85624==    by 0x115B3B: test_pending_tasks_tracking_simulado() (test_custom.cc:342)
==85624==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85624==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85624==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85624== 
==85624== ---Thread-Announcement------------------------------------------
==85624== 
==85624== Thread #1 is the program's root thread
==85624== 
==85624== ----------------------------------------------------------------
==85624== 
==85624==  Lock at 0x1FFEFFE6A0 was first observed
==85624==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85624==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==85624==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==85624==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==85624==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==85624==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85624==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85624==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85624==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85624==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85624==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85624==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85624==  Address 0x1ffeffe6a0 is on thread #1's stack
==85624==  in frame #5, created by test_pending_tasks_tracking_simulado() (test_custom.cc:340)
==85624== 
==85624== Possible data race during read of size 1 at 0x4E27868 by thread #6
==85624== Locks held: none
==85624==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==85624==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85624==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85624==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85624==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85624==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85624==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85624==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85624==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==85624==    by 0x4C3EA33: clone (clone.S:100)
==85624== 
==85624== This conflicts with a previous write of size 1 by thread #2
==85624== Locks held: 1, at address 0x1FFEFFE6A0
==85624==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==85624==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==85624==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==85624==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==85624==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==85624==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==85624==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85624==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85624==  Address 0x4e27868 is 152 bytes inside a block of size 640 alloc'd
==85624==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85624==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==85624==    by 0x1110A6: allocate (alloc_traits.h:482)
==85624==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==85624==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==85624==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==85624==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==85624==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==85624==    by 0x115B3B: test_pending_tasks_tracking_simulado() (test_custom.cc:342)
==85624==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85624==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85624==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85624==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==85624==  Block was alloc'd by thread #1
==85624== 
==85624== 
==85624== Use --history-level=approx or =none to gain increased speed, at
==85624== the cost of reduced accuracy of conflicting-access information
==85624== For lists of detected and suppressed errors, rerun with: -s
==85624== ERROR SUMMARY: 2 errors from 1 contexts (suppressed: 7786 from 16)
[1;31m❌ FAILED[0m
[34m[F01][0m Schedule from multiple threads... ==85630== ---Thread-Announcement------------------------------------------
==85630== 
==85630== Thread #10 was created
==85630==    at 0x4C3EA23: clone (clone.S:76)
==85630==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85630==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85630==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85630==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85630==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85630==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85630==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==85630==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==85630==    by 0x115D79: test_schedule_from_multiple_threads() (test_custom.cc:367)
==85630==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85630==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85630==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85630== 
==85630== ---Thread-Announcement------------------------------------------
==85630== 
==85630== Thread #2 was created
==85630==    at 0x4C3EA23: clone (clone.S:76)
==85630==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85630==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85630==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85630==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85630==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85630==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85630==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==85630==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==85630==    by 0x115D79: test_schedule_from_multiple_threads() (test_custom.cc:367)
==85630==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85630==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85630==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85630== 
==85630== ---Thread-Announcement------------------------------------------
==85630== 
==85630== Thread #1 is the program's root thread
==85630== 
==85630== ----------------------------------------------------------------
==85630== 
==85630==  Lock at 0x1FFEFFE6A0 was first observed
==85630==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85630==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==85630==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==85630==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==85630==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==85630==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85630==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85630==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85630==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85630==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85630==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85630==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85630==  Address 0x1ffeffe6a0 is on thread #1's stack
==85630==  in frame #5, created by test_schedule_from_multiple_threads() (test_custom.cc:363)
==85630== 
==85630== Possible data race during read of size 1 at 0x4E27868 by thread #10
==85630== Locks held: none
==85630==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==85630==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85630==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85630==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85630==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85630==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85630==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85630==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85630==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==85630==    by 0x4C3EA33: clone (clone.S:100)
==85630== 
==85630== This conflicts with a previous write of size 1 by thread #2
==85630== Locks held: 1, at address 0x1FFEFFE6A0
==85630==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==85630==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==85630==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==85630==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==85630==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==85630==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==85630==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85630==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85630==  Address 0x4e27868 is 152 bytes inside a block of size 1,280 alloc'd
==85630==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85630==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==85630==    by 0x1110A6: allocate (alloc_traits.h:482)
==85630==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==85630==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==85630==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==85630==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==85630==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==85630==    by 0x115D79: test_schedule_from_multiple_threads() (test_custom.cc:367)
==85630==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85630==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85630==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85630==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==85630==  Block was alloc'd by thread #1
==85630== 
==85630== 
==85630== Use --history-level=approx or =none to gain increased speed, at
==85630== the cost of reduced accuracy of conflicting-access information
==85630== For lists of detected and suppressed errors, rerun with: -s
==85630== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 148108 from 18)
[1;31m❌ FAILED[0m
[34m[F02][0m Schedule after destruction (invalid use)... ==85644== ---Thread-Announcement------------------------------------------
==85644== 
==85644== Thread #1 is the program's root thread
==85644== 
==85644== ----------------------------------------------------------------
==85644== 
==85644== Thread #1's call to pthread_mutex_unlock failed
==85644==    with error code 22 (EINVAL: Invalid argument)
==85644==    at 0x4851B5E: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85644==    by 0x10EB82: __gthread_mutex_unlock(pthread_mutex_t*) (gthr-default.h:779)
==85644==    by 0x10ED3B: std::mutex::unlock() (std_mutex.h:132)
==85644==    by 0x10F17A: std::lock_guard<std::mutex>::~lock_guard() (std_mutex.h:255)
==85644==    by 0x10E116: ThreadPool::schedule(std::function<void ()> const&) (thread-pool.cc:25)
==85644==    by 0x115FF1: test_schedule_after_destruction() (test_custom.cc:395)
==85644==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85644==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85644==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85644==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==85644==    by 0x11A00F: run_test(TestCase const&) (test_custom.cc:1044)
==85644==    by 0x11B7F8: main (test_custom.cc:1142)
==85644== 
==85644== 
==85644== Use --history-level=approx or =none to gain increased speed, at
==85644== the cost of reduced accuracy of conflicting-access information
==85644== For lists of detected and suppressed errors, rerun with: -s
==85644== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 154 from 16)
[1;31m❌ FAILED[0m
[34m[F03][0m Schedule inside another task... ==85648== 
==85648== Use --history-level=approx or =none to gain increased speed, at
==85648== the cost of reduced accuracy of conflicting-access information
==85648== For lists of detected and suppressed errors, rerun with: -s
==85648== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 280 from 12)
[1;32m✅ PASSED[0m
[34m[F04][0m Wait blocks until all tasks finish... ==85654== 
==85654== Use --history-level=approx or =none to gain increased speed, at
==85654== the cost of reduced accuracy of conflicting-access information
==85654== For lists of detected and suppressed errors, rerun with: -s
==85654== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 154 from 16)
[1;32m✅ PASSED[0m
[34m[F06][0m Many waits in parallel... ==85658== ---Thread-Announcement------------------------------------------
==85658== 
==85658== Thread #6 was created
==85658==    at 0x4C3EA23: clone (clone.S:76)
==85658==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85658==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85658==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85658==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85658==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85658==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85658==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==85658==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==85658==    by 0x1165D7: test_many_waits_during_execution() (test_custom.cc:447)
==85658==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85658==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85658==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85658== 
==85658== ---Thread-Announcement------------------------------------------
==85658== 
==85658== Thread #2 was created
==85658==    at 0x4C3EA23: clone (clone.S:76)
==85658==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85658==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85658==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85658==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85658==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85658==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85658==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==85658==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==85658==    by 0x1165D7: test_many_waits_during_execution() (test_custom.cc:447)
==85658==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85658==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85658==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85658== 
==85658== ---Thread-Announcement------------------------------------------
==85658== 
==85658== Thread #1 is the program's root thread
==85658== 
==85658== ----------------------------------------------------------------
==85658== 
==85658==  Lock at 0x1FFEFFE6A0 was first observed
==85658==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85658==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==85658==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==85658==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==85658==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==85658==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85658==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85658==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85658==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85658==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85658==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85658==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85658==  Address 0x1ffeffe6a0 is on thread #1's stack
==85658==  in frame #3, created by test_many_waits_during_execution() (test_custom.cc:445)
==85658== 
==85658== Possible data race during read of size 1 at 0x4E27868 by thread #6
==85658== Locks held: none
==85658==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==85658==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85658==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85658==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85658==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85658==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85658==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85658==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85658==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==85658==    by 0x4C3EA33: clone (clone.S:100)
==85658== 
==85658== This conflicts with a previous write of size 1 by thread #2
==85658== Locks held: 1, at address 0x1FFEFFE6A0
==85658==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==85658==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==85658==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==85658==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==85658==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==85658==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==85658==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85658==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85658==  Address 0x4e27868 is 152 bytes inside a block of size 640 alloc'd
==85658==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85658==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==85658==    by 0x1110A6: allocate (alloc_traits.h:482)
==85658==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==85658==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==85658==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==85658==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==85658==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==85658==    by 0x1165D7: test_many_waits_during_execution() (test_custom.cc:447)
==85658==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85658==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85658==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85658==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==85658==  Block was alloc'd by thread #1
==85658== 
==85658== 
==85658== Use --history-level=approx or =none to gain increased speed, at
==85658== the cost of reduced accuracy of conflicting-access information
==85658== For lists of detected and suppressed errors, rerun with: -s
==85658== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 3940 from 17)
[1;31m❌ FAILED[0m
[34m[F07][0m High contention on atomic counter... ==85669== ---Thread-Announcement------------------------------------------
==85669== 
==85669== Thread #6 was created
==85669==    at 0x4C3EA23: clone (clone.S:76)
==85669==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85669==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85669==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85669==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85669==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85669==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85669==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==85669==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==85669==    by 0x1169D1: test_high_contention_atomic_updates() (test_custom.cc:492)
==85669==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85669==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85669==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85669== 
==85669== ---Thread-Announcement------------------------------------------
==85669== 
==85669== Thread #3 was created
==85669==    at 0x4C3EA23: clone (clone.S:76)
==85669==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85669==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85669==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85669==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85669==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85669==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85669==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==85669==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==85669==    by 0x1169D1: test_high_contention_atomic_updates() (test_custom.cc:492)
==85669==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85669==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85669==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85669== 
==85669== ---Thread-Announcement------------------------------------------
==85669== 
==85669== Thread #1 is the program's root thread
==85669== 
==85669== ----------------------------------------------------------------
==85669== 
==85669==  Lock at 0x1FFEFFE6A0 was first observed
==85669==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85669==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==85669==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==85669==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==85669==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==85669==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85669==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85669==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85669==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85669==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85669==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85669==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85669==  Address 0x1ffeffe6a0 is on thread #1's stack
==85669==  in frame #5, created by test_high_contention_atomic_updates() (test_custom.cc:490)
==85669== 
==85669== Possible data race during read of size 1 at 0x4E27908 by thread #6
==85669== Locks held: none
==85669==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==85669==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85669==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85669==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85669==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85669==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85669==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85669==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85669==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==85669==    by 0x4C3EA33: clone (clone.S:100)
==85669== 
==85669== This conflicts with a previous write of size 1 by thread #3
==85669== Locks held: 1, at address 0x1FFEFFE6A0
==85669==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==85669==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==85669==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==85669==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==85669==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==85669==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==85669==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85669==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85669==  Address 0x4e27908 is 312 bytes inside a block of size 640 alloc'd
==85669==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85669==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==85669==    by 0x1110A6: allocate (alloc_traits.h:482)
==85669==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==85669==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==85669==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==85669==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==85669==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==85669==    by 0x1169D1: test_high_contention_atomic_updates() (test_custom.cc:492)
==85669==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85669==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85669==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85669==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==85669==  Block was alloc'd by thread #1
==85669== 
==85669== 
==85669== Use --history-level=approx or =none to gain increased speed, at
==85669== the cost of reduced accuracy of conflicting-access information
==85669== For lists of detected and suppressed errors, rerun with: -s
==85669== ERROR SUMMARY: 42 errors from 1 contexts (suppressed: 64894 from 16)
[1;31m❌ FAILED[0m
[34m[F08][0m Destroy pool immediately after scheduling... ==85675== 
==85675== Use --history-level=approx or =none to gain increased speed, at
==85675== the cost of reduced accuracy of conflicting-access information
==85675== For lists of detected and suppressed errors, rerun with: -s
==85675== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 808 from 12)
[1;32m✅ PASSED[0m
[34m[F09][0m Interleaved schedule/wait execution... ==85679== ---Thread-Announcement------------------------------------------
==85679== 
==85679== Thread #5 was created
==85679==    at 0x4C3EA23: clone (clone.S:76)
==85679==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85679==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85679==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85679==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85679==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85679==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85679==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==85679==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==85679==    by 0x116C77: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:529)
==85679==    by 0x12BDC0: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==85679==    by 0x12BACE: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==85679==    by 0x12B711: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==85679== 
==85679== ---Thread-Announcement------------------------------------------
==85679== 
==85679== Thread #3 was created
==85679==    at 0x4C3EA23: clone (clone.S:76)
==85679==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85679==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85679==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85679==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85679==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85679==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85679==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==85679==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==85679==    by 0x116C77: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:529)
==85679==    by 0x12BDC0: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==85679==    by 0x12BACE: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==85679==    by 0x12B711: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==85679== 
==85679== ---Thread-Announcement------------------------------------------
==85679== 
==85679== Thread #2 was created
==85679==    at 0x4C3EA23: clone (clone.S:76)
==85679==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85679==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85679==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85679==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85679==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85679==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85679==    by 0x11D3EA: std::thread::thread<test_massive_schedule_wait_interleave()::{lambda()#1}, , void>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (std_thread.h:164)
==85679==    by 0x116E22: test_massive_schedule_wait_interleave() (test_custom.cc:543)
==85679==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85679==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85679==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85679==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==85679== 
==85679== ----------------------------------------------------------------
==85679== 
==85679==  Lock at 0x5A14C00 was first observed
==85679==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85679==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==85679==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==85679==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==85679==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==85679==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85679==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85679==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85679==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85679==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85679==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85679==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85679==  Address 0x5a14c00 is on thread #2's stack
==85679==  in frame #5, created by test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:527)
==85679== 
==85679== Possible data race during read of size 1 at 0x4E27A38 by thread #5
==85679== Locks held: none
==85679==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==85679==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85679==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85679==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85679==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85679==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85679==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85679==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85679==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==85679==    by 0x4C3EA33: clone (clone.S:100)
==85679== 
==85679== This conflicts with a previous write of size 1 by thread #3
==85679== Locks held: 1, at address 0x5A14C00
==85679==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==85679==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==85679==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==85679==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==85679==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==85679==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==85679==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85679==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85679==  Address 0x4e27a38 is 152 bytes inside a block of size 320 alloc'd
==85679==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85679==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==85679==    by 0x1110A6: allocate (alloc_traits.h:482)
==85679==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==85679==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==85679==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==85679==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==85679==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==85679==    by 0x116C77: test_massive_schedule_wait_interleave()::{lambda()#1}::operator()() const (test_custom.cc:529)
==85679==    by 0x12BDC0: void std::__invoke_impl<void, test_massive_schedule_wait_interleave()::{lambda()#1}>(std::__invoke_other, test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:61)
==85679==    by 0x12BACE: std::__invoke_result<test_massive_schedule_wait_interleave()::{lambda()#1}>::type std::__invoke<test_massive_schedule_wait_interleave()::{lambda()#1}>(test_massive_schedule_wait_interleave()::{lambda()#1}&&) (invoke.h:96)
==85679==    by 0x12B711: void std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::_M_invoke<0ul>(std::_Index_tuple<0ul>) (std_thread.h:292)
==85679==    by 0x12B511: std::thread::_Invoker<std::tuple<test_massive_schedule_wait_interleave()::{lambda()#1}> >::operator()() (std_thread.h:299)
==85679==  Block was alloc'd by thread #2
==85679== 
==85679== 
==85679== Use --history-level=approx or =none to gain increased speed, at
==85679== the cost of reduced accuracy of conflicting-access information
==85679== For lists of detected and suppressed errors, rerun with: -s
==85679== ERROR SUMMARY: 2 errors from 1 contexts (suppressed: 3999 from 22)
[1;31m❌ FAILED[0m
[34m[F10][0m Multiple schedule/wait rounds... ==85684== 
==85684== Use --history-level=approx or =none to gain increased speed, at
==85684== the cost of reduced accuracy of conflicting-access information
==85684== For lists of detected and suppressed errors, rerun with: -s
==85684== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
[1;32m✅ PASSED[0m
[34m[F11][0m Multiple wait() calls inside tasks... ==85685== 
==85685== Use --history-level=approx or =none to gain increased speed, at
==85685== the cost of reduced accuracy of conflicting-access information
==85685== For lists of detected and suppressed errors, rerun with: -s
==85685== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
[1;32m✅ PASSED[0m
[34m[F12][0m Concurrent schedule/wait in parallel... ==85686== ---Thread-Announcement------------------------------------------
==85686== 
==85686== Thread #6 was created
==85686==    at 0x4C3EA23: clone (clone.S:76)
==85686==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85686==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85686==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85686==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85686==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85686==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85686==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==85686==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==85686==    by 0x1176CE: test_concurrent_schedule_wait_parallel() (test_custom.cc:634)
==85686==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85686==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85686==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85686== 
==85686== ---Thread-Announcement------------------------------------------
==85686== 
==85686== Thread #3 was created
==85686==    at 0x4C3EA23: clone (clone.S:76)
==85686==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85686==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85686==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85686==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85686==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85686==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85686==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==85686==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==85686==    by 0x1176CE: test_concurrent_schedule_wait_parallel() (test_custom.cc:634)
==85686==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85686==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85686==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85686== 
==85686== ---Thread-Announcement------------------------------------------
==85686== 
==85686== Thread #1 is the program's root thread
==85686== 
==85686== ----------------------------------------------------------------
==85686== 
==85686==  Lock at 0x1FFEFFE6A0 was first observed
==85686==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85686==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==85686==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==85686==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==85686==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==85686==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85686==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85686==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85686==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85686==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85686==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85686==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85686==  Address 0x1ffeffe6a0 is on thread #1's stack
==85686==  in frame #5, created by test_concurrent_schedule_wait_parallel() (test_custom.cc:627)
==85686== 
==85686== Possible data race during read of size 1 at 0x4E27908 by thread #6
==85686== Locks held: none
==85686==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==85686==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85686==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85686==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85686==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85686==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85686==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85686==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85686==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==85686==    by 0x4C3EA33: clone (clone.S:100)
==85686== 
==85686== This conflicts with a previous write of size 1 by thread #3
==85686== Locks held: 1, at address 0x1FFEFFE6A0
==85686==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==85686==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==85686==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==85686==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==85686==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==85686==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==85686==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85686==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85686==  Address 0x4e27908 is 312 bytes inside a block of size 640 alloc'd
==85686==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85686==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==85686==    by 0x1110A6: allocate (alloc_traits.h:482)
==85686==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==85686==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==85686==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==85686==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==85686==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==85686==    by 0x1176CE: test_concurrent_schedule_wait_parallel() (test_custom.cc:634)
==85686==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85686==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85686==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85686==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==85686==  Block was alloc'd by thread #1
==85686== 
==85686== 
==85686== Use --history-level=approx or =none to gain increased speed, at
==85686== the cost of reduced accuracy of conflicting-access information
==85686== For lists of detected and suppressed errors, rerun with: -s
==85686== ERROR SUMMARY: 29 errors from 1 contexts (suppressed: 16770 from 18)
[1;31m❌ FAILED[0m
[34m[F13][0m Worker state corruption attempt... ==85698== 
==85698== Use --history-level=approx or =none to gain increased speed, at
==85698== the cost of reduced accuracy of conflicting-access information
==85698== For lists of detected and suppressed errors, rerun with: -s
==85698== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 7554 from 16)
[1;32m✅ PASSED[0m
[31m[H01][0m Wait inside task should deadlock... ==85702== 
==85702== Use --history-level=approx or =none to gain increased speed, at
==85702== the cost of reduced accuracy of conflicting-access information
==85702== For lists of detected and suppressed errors, rerun with: -s
==85702== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
[1;32m✅ PASSED[0m
[33m[L01][0m Destructor waits for tasks completion... ==85703== 
==85703== Use --history-level=approx or =none to gain increased speed, at
==85703== the cost of reduced accuracy of conflicting-access information
==85703== For lists of detected and suppressed errors, rerun with: -s
==85703== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 70 from 12)
[1;32m✅ PASSED[0m
[33m[L02][0m Repeated pool creation and destruction... ==85706== ---Thread-Announcement------------------------------------------
==85706== 
==85706== Thread #28 was created
==85706==    at 0x4C3EA23: clone (clone.S:76)
==85706==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85706==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85706==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85706==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85706==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85706==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85706==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==85706==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==85706==    by 0x117BD6: test_repeated_pool_creation() (test_custom.cc:692)
==85706==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85706==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85706==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85706== 
==85706== ---Thread-Announcement------------------------------------------
==85706== 
==85706== Thread #26 was created
==85706==    at 0x4C3EA23: clone (clone.S:76)
==85706==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==85706==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==85706==    by 0x4BB154F: create_thread (pthread_create.c:297)
==85706==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==85706==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85706==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85706==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==85706==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==85706==    by 0x117BD6: test_repeated_pool_creation() (test_custom.cc:692)
==85706==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85706==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85706==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85706== 
==85706== ---Thread-Announcement------------------------------------------
==85706== 
==85706== Thread #1 is the program's root thread
==85706== 
==85706== ----------------------------------------------------------------
==85706== 
==85706==  Lock at 0x1FFEFFE6A0 was first observed
==85706==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85706==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==85706==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==85706==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==85706==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==85706==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85706==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85706==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85706==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85706==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85706==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85706==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85706==  Address 0x1ffeffe6a0 is on thread #1's stack
==85706==  in frame #5, created by test_repeated_pool_creation() (test_custom.cc:688)
==85706== 
==85706== Possible data race during read of size 1 at 0x4E27868 by thread #28
==85706== Locks held: none
==85706==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==85706==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==85706==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==85706==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==85706==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==85706==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==85706==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85706==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85706==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==85706==    by 0x4C3EA33: clone (clone.S:100)
==85706== 
==85706== This conflicts with a previous write of size 1 by thread #26
==85706== Locks held: 1, at address 0x1FFEFFE6A0
==85706==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==85706==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==85706==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==85706==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==85706==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==85706==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==85706==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==85706==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85706==  Address 0x4e27868 is 152 bytes inside a block of size 320 alloc'd
==85706==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==85706==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==85706==    by 0x1110A6: allocate (alloc_traits.h:482)
==85706==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==85706==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==85706==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==85706==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==85706==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==85706==    by 0x117BD6: test_repeated_pool_creation() (test_custom.cc:692)
==85706==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==85706==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==85706==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==85706==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==85706==  Block was alloc'd by thread #1
==85706== 
==85706== 
==85706== Use --history-level=approx or =none to gain increased speed, at
==85706== the cost of reduced accuracy of conflicting-access information
==85706== For lists of detected and suppressed errors, rerun with: -s
==85706== ERROR SUMMARY: 39 errors from 1 contexts (suppressed: 69817 from 16)
[1;31m❌ FAILED[0m
[33m[L03][0m Destructor during high load... ==86007== ---Thread-Announcement------------------------------------------
==86007== 
==86007== Thread #6 was created
==86007==    at 0x4C3EA23: clone (clone.S:76)
==86007==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==86007==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==86007==    by 0x4BB154F: create_thread (pthread_create.c:297)
==86007==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==86007==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==86007==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==86007==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==86007==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==86007==    by 0x11997E: test_destruction_during_load() (test_custom.cc:989)
==86007==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==86007==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==86007==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==86007== 
==86007== ---Thread-Announcement------------------------------------------
==86007== 
==86007== Thread #2 was created
==86007==    at 0x4C3EA23: clone (clone.S:76)
==86007==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==86007==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==86007==    by 0x4BB154F: create_thread (pthread_create.c:297)
==86007==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==86007==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==86007==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==86007==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==86007==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==86007==    by 0x11997E: test_destruction_during_load() (test_custom.cc:989)
==86007==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==86007==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==86007==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==86007== 
==86007== ---Thread-Announcement------------------------------------------
==86007== 
==86007== Thread #1 is the program's root thread
==86007== 
==86007== ----------------------------------------------------------------
==86007== 
==86007==  Lock at 0x1FFEFFE6A0 was first observed
==86007==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==86007==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==86007==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==86007==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==86007==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==86007==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==86007==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==86007==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==86007==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==86007==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==86007==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==86007==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==86007==  Address 0x1ffeffe6a0 is on thread #1's stack
==86007==  in frame #5, created by test_destruction_during_load() (test_custom.cc:986)
==86007== 
==86007== Possible data race during read of size 1 at 0x4E27868 by thread #6
==86007== Locks held: none
==86007==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==86007==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==86007==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==86007==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==86007==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==86007==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==86007==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==86007==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==86007==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==86007==    by 0x4C3EA33: clone (clone.S:100)
==86007== 
==86007== This conflicts with a previous write of size 1 by thread #2
==86007== Locks held: 1, at address 0x1FFEFFE6A0
==86007==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==86007==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==86007==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==86007==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==86007==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==86007==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==86007==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==86007==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==86007==  Address 0x4e27868 is 152 bytes inside a block of size 640 alloc'd
==86007==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==86007==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==86007==    by 0x1110A6: allocate (alloc_traits.h:482)
==86007==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==86007==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==86007==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==86007==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==86007==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==86007==    by 0x11997E: test_destruction_during_load() (test_custom.cc:989)
==86007==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==86007==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==86007==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==86007==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==86007==  Block was alloc'd by thread #1
==86007== 
==86007== 
==86007== Use --history-level=approx or =none to gain increased speed, at
==86007== the cost of reduced accuracy of conflicting-access information
==86007== For lists of detected and suppressed errors, rerun with: -s
==86007== ERROR SUMMARY: 69 errors from 1 contexts (suppressed: 79747 from 12)
[1;31m❌ FAILED[0m
[91m[M01][0m Schedule nullptr function... ==86013== 
==86013== Use --history-level=approx or =none to gain increased speed, at
==86013== the cost of reduced accuracy of conflicting-access information
==86013== For lists of detected and suppressed errors, rerun with: -s
==86013== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 86 from 12)
[1;32m✅ PASSED[0m
[91m[M02][0m wait() during infinite rescheduling... ==86017== 
==86017== Use --history-level=approx or =none to gain increased speed, at
==86017== the cost of reduced accuracy of conflicting-access information
==86017== For lists of detected and suppressed errors, rerun with: -s
==86017== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
[1;32m✅ PASSED[0m
[91m[M03][0m Use-after-destruction protection... ==86018== ---Thread-Announcement------------------------------------------
==86018== 
==86018== Thread #1 is the program's root thread
==86018== 
==86018== ----------------------------------------------------------------
==86018== 
==86018== Thread #1's call to pthread_mutex_unlock failed
==86018==    with error code 22 (EINVAL: Invalid argument)
==86018==    at 0x4851B5E: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==86018==    by 0x10EB82: __gthread_mutex_unlock(pthread_mutex_t*) (gthr-default.h:779)
==86018==    by 0x10ED3B: std::mutex::unlock() (std_mutex.h:132)
==86018==    by 0x10F17A: std::lock_guard<std::mutex>::~lock_guard() (std_mutex.h:255)
==86018==    by 0x10E116: ThreadPool::schedule(std::function<void ()> const&) (thread-pool.cc:25)
==86018==    by 0x119B2B: test_double_destruction_or_use_after_move() (test_custom.cc:1011)
==86018==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==86018==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==86018==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==86018==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==86018==    by 0x11A00F: run_test(TestCase const&) (test_custom.cc:1044)
==86018==    by 0x11B7F8: main (test_custom.cc:1142)
==86018== 
==86018== 
==86018== Use --history-level=approx or =none to gain increased speed, at
==86018== the cost of reduced accuracy of conflicting-access information
==86018== For lists of detected and suppressed errors, rerun with: -s
==86018== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 154 from 16)
[1;31m❌ FAILED[0m
[96m[N01][0m Deep nested task scheduling... ==86022== 
==86022== Use --history-level=approx or =none to gain increased speed, at
==86022== the cost of reduced accuracy of conflicting-access information
==86022== For lists of detected and suppressed errors, rerun with: -s
==86022== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 340 from 23)
[1;32m✅ PASSED[0m
[96m[N02][0m Extreme nested scheduling (1000)... ==86029== 
==86029== Use --history-level=approx or =none to gain increased speed, at
==86029== the cost of reduced accuracy of conflicting-access information
==86029== For lists of detected and suppressed errors, rerun with: -s
==86029== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 59509 from 23)
[1;32m✅ PASSED[0m
[95m[T01][0m Parallel speedup benchmark (4 tasks)... ==86036== 
==86036== Use --history-level=approx or =none to gain increased speed, at
==86036== the cost of reduced accuracy of conflicting-access information
==86036== For lists of detected and suppressed errors, rerun with: -s
==86036== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 473 from 16)
[1;32m✅ PASSED[0m
[95m[T02][0m Scalability bottleneck test... ==86042== ---Thread-Announcement------------------------------------------
==86042== 
==86042== Thread #6 was created
==86042==    at 0x4C3EA23: clone (clone.S:76)
==86042==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==86042==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==86042==    by 0x4BB154F: create_thread (pthread_create.c:297)
==86042==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==86042==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==86042==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==86042==    by 0x10F548: std::thread::thread<void (ThreadPool::*)(), ThreadPool*, void>(void (ThreadPool::*&&)(), ThreadPool*&&) (std_thread.h:164)
==86042==    by 0x10DE1A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:15)
==86042==    by 0x1197BD: test_scalability_with_mutex_contention() (test_custom.cc:968)
==86042==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==86042==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==86042==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==86042== 
==86042== ---Thread-Announcement------------------------------------------
==86042== 
==86042== Thread #2 was created
==86042==    at 0x4C3EA23: clone (clone.S:76)
==86042==    by 0x4C3EBA2: __clone_internal_fallback (clone-internal.c:64)
==86042==    by 0x4C3EBA2: __clone_internal (clone-internal.c:109)
==86042==    by 0x4BB154F: create_thread (pthread_create.c:297)
==86042==    by 0x4BB21A4: pthread_create@@GLIBC_2.34 (pthread_create.c:836)
==86042==    by 0x4854975: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==86042==    by 0x4955EB0: std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==86042==    by 0x10F42C: std::thread::thread<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long&, void>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&) (std_thread.h:164)
==86042==    by 0x10DD8B: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:11)
==86042==    by 0x1197BD: test_scalability_with_mutex_contention() (test_custom.cc:968)
==86042==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==86042==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==86042==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==86042== 
==86042== ---Thread-Announcement------------------------------------------
==86042== 
==86042== Thread #1 is the program's root thread
==86042== 
==86042== ----------------------------------------------------------------
==86042== 
==86042==  Lock at 0x1FFEFFE6A0 was first observed
==86042==    at 0x48512DC: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==86042==    by 0x10EB53: __gthread_mutex_lock(pthread_mutex_t*) (gthr-default.h:749)
==86042==    by 0x10ED09: std::mutex::lock() (std_mutex.h:113)
==86042==    by 0x10F157: std::lock_guard<std::mutex>::lock_guard(std::mutex&) (std_mutex.h:249)
==86042==    by 0x10E34A: ThreadPool::dispatcher() (thread-pool.cc:75)
==86042==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==86042==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==86042==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==86042==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==86042==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==86042==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==86042==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==86042==  Address 0x1ffeffe6a0 is on thread #1's stack
==86042==  in frame #5, created by test_scalability_with_mutex_contention() (test_custom.cc:966)
==86042== 
==86042== Possible data race during read of size 1 at 0x4E27868 by thread #6
==86042== Locks held: none
==86042==    at 0x10E293: ThreadPool::dispatcher() (thread-pool.cc:58)
==86042==    by 0x1129B5: void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:74)
==86042==    by 0x112827: std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) (invoke.h:96)
==86042==    by 0x11271A: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) (std_thread.h:292)
==86042==    by 0x1126AF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() (std_thread.h:299)
==86042==    by 0x11266B: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() (std_thread.h:244)
==86042==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==86042==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==86042==    by 0x4BB1AA3: start_thread (pthread_create.c:447)
==86042==    by 0x4C3EA33: clone (clone.S:100)
==86042== 
==86042== This conflicts with a previous write of size 1 by thread #2
==86042== Locks held: 1, at address 0x1FFEFFE6A0
==86042==    at 0x10E6A9: ThreadPool::worker(unsigned long) (thread-pool.cc:115)
==86042==    by 0x112AA8: void std::__invoke_impl<void, void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:74)
==86042==    by 0x112905: std::__invoke_result<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>::type std::__invoke<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long>(void (ThreadPool::*&&)(unsigned long), ThreadPool*&&, unsigned long&&) (invoke.h:96)
==86042==    by 0x112784: void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::_M_invoke<0ul, 1ul, 2ul>(std::_Index_tuple<0ul, 1ul, 2ul>) (std_thread.h:292)
==86042==    by 0x1126CF: std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> >::operator()() (std_thread.h:299)
==86042==    by 0x11268F: std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(unsigned long), ThreadPool*, unsigned long> > >::_M_run() (std_thread.h:244)
==86042==    by 0x4955DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)
==86042==    by 0x4854B7A: ??? (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==86042==  Address 0x4e27868 is 152 bytes inside a block of size 640 alloc'd
==86042==    at 0x4849023: operator new(unsigned long) (in /usr/libexec/valgrind/vgpreload_helgrind-amd64-linux.so)
==86042==    by 0x111D07: std::__new_allocator<ThreadPool::Worker>::allocate(unsigned long, void const*) (new_allocator.h:151)
==86042==    by 0x1110A6: allocate (alloc_traits.h:482)
==86042==    by 0x1110A6: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_allocate(unsigned long) (stl_vector.h:381)
==86042==    by 0x110522: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_M_create_storage(unsigned long) (stl_vector.h:398)
==86042==    by 0x10FAC2: std::_Vector_base<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::_Vector_base(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:335)
==86042==    by 0x10F1C2: std::vector<ThreadPool::Worker, std::allocator<ThreadPool::Worker> >::vector(unsigned long, std::allocator<ThreadPool::Worker> const&) (stl_vector.h:557)
==86042==    by 0x10DC5A: ThreadPool::ThreadPool(unsigned long) (thread-pool.cc:5)
==86042==    by 0x1197BD: test_scalability_with_mutex_contention() (test_custom.cc:968)
==86042==    by 0x134BEA: bool std::__invoke_impl<bool, bool (*&)()>(std::__invoke_other, bool (*&)()) (invoke.h:61)
==86042==    by 0x1337AB: std::enable_if<!std::is_void<bool>::value, bool>::type std::__invoke_r<bool, bool (*&)()>(bool (*&)()) (invoke.h:138)
==86042==    by 0x131ADD: std::_Function_handler<bool (), bool (*)()>::_M_invoke(std::_Any_data const&) (std_function.h:290)
==86042==    by 0x12F603: std::function<bool ()>::operator()() const (std_function.h:591)
==86042==  Block was alloc'd by thread #1
==86042== 
==86042== 
==86042== Use --history-level=approx or =none to gain increased speed, at
==86042== the cost of reduced accuracy of conflicting-access information
==86042== For lists of detected and suppressed errors, rerun with: -s
==86042== ERROR SUMMARY: 78 errors from 1 contexts (suppressed: 66971 from 16)
[1;31m❌ FAILED[0m

========================================
Ran 39 tests.
❌ SOME TESTS FAILED
========================================
==85484== 
==85484== Use --history-level=approx or =none to gain increased speed, at
==85484== the cost of reduced accuracy of conflicting-access information
==85484== For lists of detected and suppressed errors, rerun with: -s
==85484== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
